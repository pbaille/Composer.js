// Generated by CoffeeScript 1.6.3
(function() {
  define(["lib/core/base/Note", "lib/utils/Rational"], function() {
    var Note, Rational, root;
    Note = AC.Core.Note;
    Rational = AC.Utils.Rational;
    if (typeof global !== "undefined" && global !== null) {
      root = global.AC.MIDI;
    } else {
      root = window.AC.MIDI;
    }
    root.play = function(opt) {
      var at, channel, n, notes, tempo, _i, _len;
      if (!opt) {
        opt = {};
      }
      tempo = opt.tempo || 60;
      notes = opt.note || new Note("C0");
      channel = 143 + opt.channel || 144;
      at = opt.at || window.performance.now();
      if (!notes.length) {
        notes = [notes];
      }
      for (_i = 0, _len = notes.length; _i < _len; _i++) {
        n = notes[_i];
        console.log("duration: " + n.duration.toFloat() * 1000);
        midiOut.send([channel, n.pitch.value, n.velocity], at);
        midiOut.send([channel, n.pitch.value, 0], at + n.duration.toFloat() * 1000 - 1);
      }
      return "play_end";
    };
    root.simple_play = function(opt) {
      var at, channel, duration, pitch, vel;
      pitch = opt.pitch;
      vel = opt.velocity;
      at = opt.at || window.performance.now();
      duration = opt.duration || at + 1000;
      channel = 143 + opt.channel || 144;
      midiOut.send([channel, pitch, vel], at);
      midiOut.send([channel, pitch, 0], at + duration);
      return "simple_play_end";
    };
    root.all_off = function(chan) {
      var channel, i, _i, _results;
      channel = 143 + chan || 144;
      _results = [];
      for (i = _i = 0; _i <= 127; i = ++_i) {
        _results.push(midiOut.send([channel, i, 0], window.performance.now()));
      }
      return _results;
    };
    return root;
  });

}).call(this);
